<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TronAdsFaucet - Watch Ads, Earn TRON</title>
    
    <script src="https://js.onclckvd.com/in-stream-ad-admanager/tma.js"></script>
    
    <script src="https://adexora.com/cdn/ads.js?id=494"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #1e293b;
            --tg-theme-button-color: #d62939;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-hint-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #d62939;
            --secondary-bg-color: #f8fafc;
            --border-color: #e2e8f0;
            --accent-color: #d62939;
            --gradient-primary: linear-gradient(135deg, #d62939 0%, #b71c1c 100%);
            --gradient-secondary: linear-gradient(135deg, #d62939 0%, #9c1c1c 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-card: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            --shadow: 0 10px 25px rgba(214, 41, 57, 0.15);
            --shadow-light: 0 5px 15px rgba(214, 41, 57, 0.1);
            --radius: 16px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px 15px 100px 15px;
        }

        .view {
            display: none;
            width: 100%;
            animation: fadeInUp 0.5s ease-out;
        }

        #home-view {
            display: block;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            animation: fadeInUp 0.6s ease-out;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        .logo {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            animation: float 3s ease-in-out infinite;
        }

        .logo i {
            font-size: 32px;
            color: white;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(90deg, #d62939, #b71c1c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .header p {
            color: var(--tg-theme-hint-color);
            font-size: 16px;
        }

        .admin-header-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--gradient-warning);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 10px 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .admin-header-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        /* Card Styles */
        .card {
            background: var(--gradient-card);
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(214, 41, 57, 0.2);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .card h2 {
            margin: 0 0 15px 0;
            font-size: 16px;
            color: var(--tg-theme-hint-color);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--accent-color);
        }

        /* Balance Styles */
        .balance-amount {
            font-size: 42px;
            font-weight: 700;
            color: var(--tg-theme-text-color);
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(90deg, #d62939, #b71c1c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite;
        }

        /* Grid Styles */
        .ad-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            text-align: center;
        }

        .ad-info-item {
            background: rgba(214, 41, 57, 0.05);
            padding: 15px;
            border-radius: 12px;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .ad-info-item:hover {
            background: rgba(214, 41, 57, 0.1);
            transform: translateY(-3px);
        }

        .ad-info-item h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 5px 0;
            color: var(--tg-theme-text-color);
        }

        .ad-info-item p {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            margin: 0;
        }

        /* Button Styles */
        .btn {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-light);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--tg-theme-button-text-color);
        }

        .btn-success {
            background: var(--gradient-success);
            color: var(--tg-theme-button-text-color);
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: var(--tg-theme-button-text-color);
        }

        .btn:disabled {
            background: #cbd5e1;
            color: #64748b;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .btn:disabled::before {
            display: none;
        }

        .ad-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        /* Loading Button */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Message */
        .status-message {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 480px;
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: 500;
            display: none;
            animation: slideInUp 0.3s ease-out;
            z-index: 1000;
            box-sizing: border-box;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border-left: 4px solid;
            color: var(--tg-theme-text-color);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .success {
            display: block;
            border-left-color: var(--success-color);
        }

        .error {
            display: block;
            border-left-color: var(--danger-color);
        }

        .info {
            display: block;
            border-left-color: var(--tg-theme-button-color);
        }

        /* Footer Navigation */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--secondary-bg-color);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -5px 20px rgba(214, 41, 57, 0.1);
            border-top: 1px solid var(--border-color);
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--tg-theme-hint-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 12px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }

        .nav-btn.active {
            color: white;
        }

        .nav-btn.active::before {
            opacity: 1;
        }

        .nav-btn:hover:not(.active) {
            color: var(--tg-theme-text-color);
            transform: translateY(-3px);
        }

        .nav-btn .icon {
            width: 24px;
            height: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .nav-btn.active .icon {
            animation: bounce 0.5s;
        }

        /* Input Styles */
        .input-group {
            margin-bottom: 20px;
            text-align: left;
            animation: fadeInUp 0.5s ease-out;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--tg-theme-hint-color);
            font-size: 14px;
            font-weight: 500;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.8);
            color: var(--tg-theme-text-color);
            font-size: 16px;
            box-sizing: border-box;
            transition: var(--transition);
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: var(--tg-theme-button-color);
            box-shadow: 0 0 0 3px rgba(214, 41, 57, 0.2);
            background: rgba(255, 255, 255, 1);
        }

        /* Referral Styles */
        .referral-input-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(214, 41, 57, 0.05);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            animation: fadeInUp 0.5s ease-out;
        }

        .referral-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .referral-input-group input {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.8);
            color: var(--tg-theme-text-color);
        }

        .referral-input-group button {
            padding: 14px 20px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .referral-input-group button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .referral-code-box {
            background: rgba(214, 41, 57, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px dashed var(--tg-theme-hint-color);
            margin-top: 15px;
            cursor: pointer;
            color: var(--tg-theme-text-color);
            transition: var(--transition);
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 1px;
            animation: fadeInUp 0.5s ease-out;
            word-break: break-all;
        }

        .referral-code-box:hover {
            background: rgba(214, 41, 57, 0.1);
            border-color: var(--accent-color);
            transform: translateY(-3px);
        }

        /* Referral Share Button */
        .referral-share-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            box-shadow: var(--shadow-light);
        }

        .referral-share-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        /* Chart Styles */
        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(214, 41, 57, 0.05);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            animation: fadeInUp 0.5s ease-out;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--tg-theme-text-color);
        }

        .chart-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--success-color);
        }

        .chart-change {
            font-size: 14px;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 6px;
        }

        .chart-change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .chart-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        .chart-placeholder {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            color: var(--tg-theme-hint-color);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .chart-placeholder:hover {
            background: rgba(214, 41, 57, 0.1);
        }

        .chart-info {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }

        /* TRX Chart Canvas */
        #trxChartCanvas {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        /* Admin Styles */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-stat-card {
            background: rgba(214, 41, 57, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: var(--transition);
            animation: fadeInUp 0.5s ease-out;
        }

        .admin-stat-card:hover {
            background: rgba(214, 41, 57, 0.1);
            transform: translateY(-3px);
        }

        .admin-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--tg-theme-text-color);
            margin-bottom: 5px;
        }

        .admin-stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            text-transform: uppercase;
        }

        .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .admin-control-btn {
            padding: 14px;
            background: var(--gradient-warning);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .admin-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .admin-control-btn.danger {
            background: var(--gradient-secondary);
        }

        /* Admin User List */
        .admin-user-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .admin-user-item {
            background: rgba(214, 41, 57, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .admin-user-item:hover {
            background: rgba(214, 41, 57, 0.1);
            transform: translateY(-2px);
        }

        .admin-user-info {
            flex: 1;
        }

        .admin-user-id {
            font-weight: bold;
            color: var(--tg-theme-text-color);
            margin-bottom: 5px;
        }

        .admin-user-balance {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 3px;
        }

        .admin-user-date {
            font-size: 11px;
            color: var(--tg-theme-hint-color);
        }

        .admin-user-actions {
            display: flex;
            gap: 5px;
        }

        .admin-action-btn {
            padding: 6px 10px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: var(--transition);
        }

        .admin-action-btn:hover {
            transform: translateY(-2px);
        }

        /* Withdraw Requests */
        .withdraw-requests-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .withdraw-request-item {
            background: rgba(214, 41, 57, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .withdraw-request-item:hover {
            background: rgba(214, 41, 57, 0.1);
            transform: translateY(-2px);
        }

        .withdraw-request-info {
            margin-bottom: 10px;
        }

        .withdraw-request-user {
            font-weight: bold;
            color: var(--tg-theme-text-color);
            margin-bottom: 5px;
        }

        .withdraw-request-details {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 3px;
        }

        .withdraw-request-address {
            font-size: 11px;
            color: var(--tg-theme-hint-color);
            background: rgba(214, 41, 57, 0.1);
            padding: 8px;
            border-radius: 6px;
            margin: 5px 0;
            cursor: pointer;
            transition: var(--transition);
            word-break: break-all;
        }

        .withdraw-request-address:hover {
            background: rgba(214, 41, 57, 0.2);
        }

        .withdraw-request-date {
            font-size: 11px;
            color: var(--tg-theme-hint-color);
        }

        .withdraw-request-actions {
            display: flex;
            gap: 10px;
        }

        .withdraw-action-btn {
            padding: 8px 12px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: var(--transition);
        }

        .withdraw-action-btn.approve {
            background: var(--gradient-success);
        }

        .withdraw-action-btn.reject {
            background: var(--gradient-secondary);
        }

        .withdraw-action-btn:hover {
            transform: translateY(-2px);
        }

        /* Referral History */
        .referral-history {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .referral-history-item {
            background: rgba(214, 41, 57, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .referral-history-item:hover {
            background: rgba(214, 41, 57, 0.1);
            transform: translateY(-2px);
        }

        .referral-history-user {
            font-weight: bold;
            color: var(--tg-theme-text-color);
            margin-bottom: 5px;
        }

        .referral-history-date {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }

        .referral-history-bonus {
            font-size: 14px;
            color: var(--success-color);
            font-weight: bold;
        }

        /* About Styles */
        .about-section {
            margin-bottom: 20px;
        }

        .about-section h3 {
            color: var(--tg-theme-text-color);
            margin-bottom: 10px;
            font-size: 16px;
        }

        .about-section p {
            color: var(--tg-theme-hint-color);
            line-height: 1.6;
        }

        /* Countdown Timer */
        .countdown-timer {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
        }

        /* Ad Progress */
        .ad-progress {
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }

        .ad-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(214, 41, 57, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .ad-progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                padding: 15px 10px 90px 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .balance-amount {
                font-size: 36px;
            }
            
            .btn {
                padding: 16px;
                font-size: 16px;
            }
            
            .footer-nav {
                padding: 10px 0;
            }
            
            .nav-btn {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="home-view" class="view">
            <div class="header">
                <div class="logo-container">
                    <div class="logo">
                        <i class="fas fa-ad"></i>
                    </div>
                </div>
                <h1>TronAdsFaucet</h1>
                <p>Watch Ads and Earn TRON</p>
                <button class="admin-header-btn" id="adminHeaderBtn" style="display: none;">
                    <i class="fas fa-cog"></i>
                    Admin
                </button>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-line"></i> TRON Price</h2>
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">TRON (TRX)</div>
                        <div class="chart-price" id="tronPrice">Loading...</div>
                    </div>
                    <div class="chart-change-container">
                        <span class="chart-change" id="tronChange">24h: 0.00%</span>
                    </div>
                    <div class="chart-placeholder" id="tronChart">
                        <canvas id="trxChartCanvas"></canvas>
                    </div>
                    <div class="chart-info">
                        Real-time data from CoinGecko
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-wallet"></i> Current Balance</h2>
                <div class="balance-amount" id="balanceDisplay">TRX 0.00</div>
                <div class="ad-info-grid">
                    <div class="ad-info-item">
                        <h3 id="adCountDisplay">0</h3>
                        <p>Total Ads Watched</p>
                    </div>
                    <div class="ad-info-item">
                        <h3 id="dailyAdCountDisplay">0</h3>
                        <p>Today's Ads</p>
                    </div>
                </div>
            </div>
            
            <div class="ad-buttons">
                <button class="btn btn-primary" id="rewardedBtn">
                    <i class="fas fa-play-circle"></i>
                    Watch 2 Ads (+0.001$)
                </button>
                <div class="ad-progress" id="adProgress" style="display: none;">
                    <div>Watching ads: <span id="currentAd">1</span>/2</div>
                    <div class="ad-progress-bar">
                        <div class="ad-progress-fill" id="adProgressFill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="countdown-timer" id="countdownTimer" style="display: none;"></div>
            </div>
            
            <button class="btn btn-success" id="mainWithdrawBtn" disabled>
                <i class="fas fa-money-bill-wave"></i>
                Reach 0.10 TRX to Withdraw
            </button>
        </div>

        <div id="withdraw-view" class="view">
            <div class="header">
                <h1>Withdraw</h1>
                <p>Claim your earnings</p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-wallet"></i> Your Balance</h2>
                <div class="balance-amount" id="withdrawBalanceDisplay">TRX 0.00</div>
                <p style="color: var(--tg-theme-hint-color); margin-top: 15px; text-align: center;">
                    Minimum withdrawal amount is 0.10 TRX.
                </p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-money-check"></i> Payment Details</h2>
                <div class="input-group">
                    <label for="paymentAddress"><i class="fas fa-address-card"></i> Your TRON Wallet Address</label>
                    <input type="text" id="paymentAddress" placeholder="T... (TRON Address)">
                    <p style="font-size: 12px; color: var(--tg-theme-hint-color); margin-top: 5px;">
                        Enter your TRON (TRC20) address. Must start with T.
                    </p>
                </div>
                
                <div class="input-group">
                    <label for="withdrawAmount"><i class="fas fa-coins"></i> Amount to Withdraw (TRX)</label>
                    <input type="number" id="withdrawAmount" placeholder="0.10">
                    <p style="font-size: 12px; color: var(--tg-theme-hint-color); margin-top: 5px;">
                        Minimum: 0.10 TRX
                    </p>
                </div>
                
                <button class="btn btn-success" id="withdrawBtn" disabled>
                    <i class="fas fa-paper-plane"></i>
                    Submit Withdrawal Request
                </button>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-history"></i> Withdrawal History</h2>
                <div id="withdrawHistory">
                    <p style="text-align: center; color: var(--tg-theme-hint-color);">
                        You don't have any withdrawal requests yet.
                    </p>
                </div>
            </div>
        </div>

        <div id="referral-view" class="view">
            <div class="header">
                <h1>Invite Friends</h1>
                <p>Invite your friends and earn bonuses</p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-user-plus"></i> Your Referral Info</h2>
                <div class="ad-info-grid">
                    <div class="ad-info-item">
                        <h3 id="referralCount">0</h3>
                        <p>Invited</p>
                    </div>
                    <div class="ad-info-item">
                        <h3 id="referralEarnings">0 TRX</h3>
                        <p>Total Earnings</p>
                    </div>
                </div>
                
                <div class="referral-code-box" id="referralCodeBox">
                    Loading...
                </div>
                
                <button class="referral-share-btn" id="shareReferralBtn">
                    <i class="fas fa-share-alt"></i>
                    Share Referral Code
                </button>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-gift"></i> Invite Your Friend</h2>
                <p style="margin-bottom: 15px; color: var(--tg-theme-hint-color);">
                    Invite your friends and earn <strong>0.01$</strong> bonus for each!
                </p>
                
                <div class="referral-input-container">
                    <h3 style="margin-bottom: 10px; color: var(--tg-theme-text-color);">Enter Referral Code</h3>
                    <p style="font-size: 14px; color: var(--tg-theme-hint-color); margin-bottom: 10px;">
                        Enter a friend's referral code to get a bonus.
                    </p>
                    <div class="referral-input-group">
                        <input type="text" id="referralInput" placeholder="Enter referral code">
                        <button id="applyReferralBtn">Apply</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-list"></i> Referral History</h2>
                <div id="referralHistoryList">
                    <p style="text-align: center; color: var(--tg-theme-hint-color);">
                        You don't have any referral history yet.
                    </p>
                </div>
            </div>
        </div>

        <div id="about-view" class="view">
            <div class="header">
                <h1>About</h1>
                <p>Learn more about TronAdsFaucet</p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-info-circle"></i> How It Works</h2>
                <div class="about-section">
                    <h3>1. Watch Ads</h3>
                    <p>Watch ads and earn TRON cryptocurrency. Each ad gives you 0.0005$ worth of TRON.</p>
                </div>
                
                <div class="about-section">
                    <h3>2. Invite Friends</h3>
                    <p>Invite your friends and earn 0.01$ bonus for each friend who joins using your referral code.</p>
                </div>
                
                <div class="about-section">
                    <h3>3. Withdraw Earnings</h3>
                    <p>Withdraw your earnings to your TRON wallet when you reach the minimum amount of 0.10 TRX.</p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-question-circle"></i> FAQ</h2>
                <div class="about-section">
                    <h3>How many ads can I watch per day?</h3>
                    <p>There's no daily limit! You can watch ads as many times as you want.</p>
                </div>
                
                <div class="about-section">
                    <h3>What is the minimum withdrawal amount?</h3>
                    <p>The minimum withdrawal amount is 0.10 TRX.</p>
                </div>
                
                <div class="about-section">
                    <h3>How long do withdrawals take?</h3>
                    <p>Withdrawal requests are processed within 24-48 hours.</p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-shield-alt"></i> Privacy & Security</h2>
                <p style="color: var(--tg-theme-hint-color);">
                    Your personal information is safe. We only require your TRON wallet address for withdrawals.
                </p>
            </div>
        </div>

        <div id="admin-view" class="view">
            <div class="header">
                <h1>Admin Panel</h1>
                <p>Application management and statistics</p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> General Statistics</h2>
                <div class="admin-stats-grid">
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminTotalUsers">0</div>
                        <div class="admin-stat-label">Total Users</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminTotalAds">0</div>
                        <div class="admin-stat-label">Total Ads</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminTotalWithdrawals">0</div>
                        <div class="admin-stat-label">Total Withdrawals</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminTotalReferrals">0</div>
                        <div class="admin-stat-label">Total Referrals</div>
                    </div>
                </div>
                
                <div class="admin-controls">
                    <button class="admin-control-btn" id="adminResetStatsBtn">
                        <i class="fas fa-redo"></i> Reset Statistics
                    </button>
                    <button class="admin-control-btn danger" id="adminClearDataBtn">
                        <i class="fas fa-trash"></i> Clear All Data
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-users"></i> User Management</h2>
                <div class="admin-user-list" id="adminUserList">
                    <p style="text-align: center; color: var(--tg-theme-hint-color);">
                    Loading users...
                    </p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-money-bill-wave"></i> Withdrawal Requests</h2>
                <div class="withdraw-requests-list" id="withdrawRequestsList">
                    <p style="text-align: center; color: var(--tg-theme-hint-color);">
                    No pending withdrawal requests.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="status-message" id="statusMessage"></div>

    <div class="footer-nav">
        <button class="nav-btn active" data-view="home-view">
            <div class="icon"><i class="fas fa-home"></i></div>
            Home
        </button>
        <button class="nav-btn" data-view="withdraw-view">
            <div class="icon"><i class="fas fa-wallet"></i></div>
            Withdraw
        </button>
        <button class="nav-btn" data-view="referral-view">
            <div class="icon"><i class="fas fa-users"></i></div>
            Referral
        </button>
        <button class="nav-btn" data-view="about-view">
            <div class="icon"><i class="fas fa-info-circle"></i></div>
            About
        </button>
    </div>

    <script>
        // Application state
        const appState = {
            balance: 0,
            adCount: 0,
            dailyAdCount: 0,
            referralCount: 0,
            referralEarnings: 0,
            userId: null,
            referralCode: null,
            hasAppliedReferral: false,
            isAdmin: false,
            minWithdrawal: 0.10,
            adReward: 0.0005, // Per ad
            totalAdReward: 0.001, // For 2 ads
            referralReward: 0.01,
            tronPrice: 0,
            tronChange: 0,
            adManager: null,
            adexoraReady: false,
            adCooldown: false,
            cooldownTime: 30, // 30 seconds cooldown
            currentAdIndex: 0,
            totalAds: 2
        };

        // Admin user IDs
        const adminUsers = ['8401848644', '7904032877'];

        // DOM elements
        const views = document.querySelectorAll('.view');
        const navButtons = document.querySelectorAll('.nav-btn');
        const balanceDisplay = document.getElementById('balanceDisplay');
        const adCountDisplay = document.getElementById('adCountDisplay');
        const dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay');
        const referralCount = document.getElementById('referralCount');
        const referralEarnings = document.getElementById('referralEarnings');
        const referralCodeBox = document.getElementById('referralCodeBox');
        const shareReferralBtn = document.getElementById('shareReferralBtn');
        const applyReferralBtn = document.getElementById('applyReferralBtn');
        const referralInput = document.getElementById('referralInput');
        const rewardedBtn = document.getElementById('rewardedBtn');
        const adProgress = document.getElementById('adProgress');
        const currentAd = document.getElementById('currentAd');
        const adProgressFill = document.getElementById('adProgressFill');
        const countdownTimer = document.getElementById('countdownTimer');
        const mainWithdrawBtn = document.getElementById('mainWithdrawBtn');
        const withdrawBalanceDisplay = document.getElementById('withdrawBalanceDisplay');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const paymentAddress = document.getElementById('paymentAddress');
        const withdrawAmount = document.getElementById('withdrawAmount');
        const adminHeaderBtn = document.getElementById('adminHeaderBtn');
        const adminView = document.getElementById('admin-view');
        const adminTotalUsers = document.getElementById('adminTotalUsers');
        const adminTotalAds = document.getElementById('adminTotalAds');
        const adminTotalWithdrawals = document.getElementById('adminTotalWithdrawals');
        const adminTotalReferrals = document.getElementById('adminTotalReferrals');
        const adminUserList = document.getElementById('adminUserList');
        const withdrawRequestsList = document.getElementById('withdrawRequestsList');
        const adminResetStatsBtn = document.getElementById('adminResetStatsBtn');
        const adminClearDataBtn = document.getElementById('adminClearDataBtn');
        const statusMessage = document.getElementById('statusMessage');
        const tronPriceElement = document.getElementById('tronPrice');
        const tronChangeElement = document.getElementById('tronChange');
        const trxChartCanvas = document.getElementById('trxChartCanvas');

        // When page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadUserData();
            loadTronPrice();
            initializeAdManager();
        });

        // Initialize app
        function initializeApp() {
            // Create user ID
            if (!localStorage.getItem('userId')) {
                const userId = generateUserId();
                localStorage.setItem('userId', userId);
            }
            
            appState.userId = localStorage.getItem('userId');
            
            // Create referral code
            if (!localStorage.getItem('referralCode')) {
                const referralCode = generateReferralCode();
                localStorage.setItem('referralCode', referralCode);
            }
            
            appState.referralCode = localStorage.getItem('referralCode');
            
            // Admin check
            if (adminUsers.includes(appState.userId) || localStorage.getItem('isAdmin') === 'true') {
                appState.isAdmin = true;
                adminHeaderBtn.style.display = 'flex';
            }
            
            // Check if referral applied
            if (localStorage.getItem('hasAppliedReferral')) {
                appState.hasAppliedReferral = true;
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation buttons
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetView = this.getAttribute('data-view');
                    showView(targetView);
                    
                    // Update active button
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Admin button
            adminHeaderBtn.addEventListener('click', function() {
                showView('admin-view');
                navButtons.forEach(btn => btn.classList.remove('active'));
            });
            
            // Ad button
            rewardedBtn.addEventListener('click', showAds);
            
            // Withdraw button
            mainWithdrawBtn.addEventListener('click', function() {
                showView('withdraw-view');
                navButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelector('[data-view="withdraw-view"]').classList.add('active');
            });
            
            withdrawBtn.addEventListener('click', requestWithdrawal);
            
            // Referral buttons
            shareReferralBtn.addEventListener('click', shareReferralCode);
            applyReferralBtn.addEventListener('click', applyReferralCode);
            
            // Admin buttons
            adminResetStatsBtn.addEventListener('click', resetAdminStats);
            adminClearDataBtn.addEventListener('click', clearAllData);
            
            // Withdraw amount change
            withdrawAmount.addEventListener('input', updateWithdrawButton);
            
            // Referral code copy
            referralCodeBox.addEventListener('click', copyReferralCode);
        }

        // Load user data
        function loadUserData() {
            // Balance
            const savedBalance = localStorage.getItem('balance');
            if (savedBalance) {
                appState.balance = parseFloat(savedBalance);
            }
            
            // Ad count
            const savedAdCount = localStorage.getItem('adCount');
            if (savedAdCount) {
                appState.adCount = parseInt(savedAdCount);
            }
            
            // Daily ad count
            const savedDailyAdCount = localStorage.getItem('dailyAdCount');
            if (savedDailyAdCount) {
                appState.dailyAdCount = parseInt(savedDailyAdCount);
            }
            
            // Referral count
            const savedReferralCount = localStorage.getItem('referralCount');
            if (savedReferralCount) {
                appState.referralCount = parseInt(savedReferralCount);
            }
            
            // Referral earnings
            const savedReferralEarnings = localStorage.getItem('referralEarnings');
            if (savedReferralEarnings) {
                appState.referralEarnings = parseFloat(savedReferralEarnings);
            }
            
            // Update UI
            updateUI();
        }

        // Update UI
        function updateUI() {
            // Balance
            const balanceInTRX = appState.balance / appState.tronPrice;
            balanceDisplay.textContent = `TRX ${balanceInTRX.toFixed(4)}`;
            withdrawBalanceDisplay.textContent = `TRX ${balanceInTRX.toFixed(4)}`;
            
            // Ad counts
            adCountDisplay.textContent = appState.adCount;
            dailyAdCountDisplay.textContent = appState.dailyAdCount;
            
            // Referral info
            referralCount.textContent = appState.referralCount;
            referralEarnings.textContent = `${appState.referralEarnings.toFixed(4)} TRX`;
            referralCodeBox.textContent = appState.referralCode;
            
            // Update withdraw button
            if (balanceInTRX >= appState.minWithdrawal) {
                mainWithdrawBtn.disabled = false;
                mainWithdrawBtn.innerHTML = '<i class="fas fa-money-bill-wave"></i> Withdraw (' + balanceInTRX.toFixed(4) + ' TRX)';
            } else {
                mainWithdrawBtn.disabled = true;
                mainWithdrawBtn.innerHTML = '<i class="fas fa-money-bill-wave"></i> Reach ' + appState.minWithdrawal + ' TRX to Withdraw';
            }
            
            // Update ad button based on cooldown
            if (appState.adCooldown) {
                rewardedBtn.disabled = true;
            } else {
                rewardedBtn.disabled = false;
            }
            
            // Update admin panel
            if (appState.isAdmin) {
                updateAdminPanel();
            }
        }

        // Show view
        function showView(viewId) {
            views.forEach(view => {
                view.style.display = 'none';
            });
            
            document.getElementById(viewId).style.display = 'block';
            
            // Special view operations
            if (viewId === 'admin-view') {
                updateAdminPanel();
            } else if (viewId === 'withdraw-view') {
                updateWithdrawButton();
            }
        }

        // Show ads (both TMA and Adexora)
        function showAds() {
            // Check if in cooldown
            if (appState.adCooldown) {
                showStatus('Please wait before watching more ads.', 'error');
                return;
            }
            
            // Reset ad index
            appState.currentAdIndex = 0;
            
            // Set button to loading state
            rewardedBtn.classList.add('btn-loading');
            rewardedBtn.disabled = true;
            
            // Show progress
            adProgress.style.display = 'block';
            updateAdProgress();
            
            // Start showing ads
            showNextAd();
        }

        // Show next ad in sequence (SEQUENTIAL LOGIC)
        function showNextAd() {
            appState.currentAdIndex++;
            currentAd.textContent = appState.currentAdIndex;
            updateAdProgress();
            
            if (appState.currentAdIndex === 1) {
                // 1. Reklam: TMA
                showTMAAd();
            } else if (appState.currentAdIndex === 2) {
                // 2. Reklam: Adexora
                showAdexoraAd();
            }
        }

        // Show TMA ad
        function showTMAAd() {
            if (!appState.adManager) {
                showStatus('TMA ad could not be loaded. Trying next ad...', 'error');
                showNextAd(); // Continue to next ad
                return;
            }
            
            try {
                appState.adManager()
                    .then(() => {
                        // Ad successful - 5 saniye bekleme eklendi
                        showStatus('TMA reklam baaryla tamamland. 5 saniye bekleniyor...', 'info');
                        
                        setTimeout(() => {
                            showStatus('Bekleme tamamland. kinci reklam balatlyor.', 'info');
                            showNextAd();
                        }, 5000); // 5000 milliseconds = 5 seconds
                    })
                    .catch(error => {
                        console.error('TMA ad error:', error);
                        showStatus('TMA ad could not be loaded. Trying next ad...', 'error');
                        showNextAd(); // Continue to next ad
                    });
            } catch (error) {
                console.error('TMA ad error:', error);
                showStatus('TMA ad could not be loaded. Trying next ad...', 'error');
                showNextAd(); // Continue to next ad
            }
        }

        // Show Adexora ad
        function showAdexoraAd() {
            if (typeof window.showAdexora !== 'function') {
                showStatus('Adexora ad could not be loaded. Completing session...', 'error');
                completeAdSession();
                return;
            }
            
            try {
                window.showAdexora()
                    .then(() => {
                        // Ad successful - 5 saniye bekleme eklendi
                        showStatus('Adexora reklam baaryla tamamland. 5 saniye bekleniyor...', 'info');
                        
                        setTimeout(() => {
                            showStatus('Bekleme tamamland. dl veriliyor.', 'info');
                            completeAdSession();
                        }, 5000); // 5000 milliseconds = 5 seconds
                    })
                    .catch(error => {
                        console.error('Adexora ad error:', error);
                        showStatus('Adexora ad could not be loaded. Completing session...', 'error');
                        completeAdSession();
                    });
            } catch (error) {
                console.error('Adexora ad error:', error);
                showStatus('Adexora ad could not be loaded. Completing session...', 'error');
                completeAdSession();
            }
        }

        // Complete ad session and reward user
        function completeAdSession() {
            // Calculate reward in TRX (for both ads)
            const rewardInTRX = appState.totalAdReward / appState.tronPrice;
            
            // Update balance
            appState.balance += rewardInTRX;
            appState.adCount += appState.totalAds;
            appState.dailyAdCount += appState.totalAds;
            
            // Update local storage
            localStorage.setItem('balance', appState.balance);
            localStorage.setItem('adCount', appState.adCount);
            localStorage.setItem('dailyAdCount', appState.dailyAdCount);
            
            // Update UI
            updateUI();
            
            // Show success message
            showStatus(`Congratulations! You earned ${rewardInTRX.toFixed(6)} TRX from ${appState.totalAds} ads.`, 'success');
            
            // Reset button and progress
            resetAdButton();
            
            // Start cooldown
            startCooldown();
        }

        // Update ad progress
        function updateAdProgress() {
            const progress = (appState.currentAdIndex / appState.totalAds) * 100;
            adProgressFill.style.width = `${progress}%`;
        }

        // Reset ad button
        function resetAdButton() {
            rewardedBtn.classList.remove('btn-loading');
            adProgress.style.display = 'none';
        }

        // Start cooldown after ads
        function startCooldown() {
            appState.adCooldown = true;
            let timeLeft = appState.cooldownTime;
            
            // Show countdown timer
            countdownTimer.style.display = 'block';
            countdownTimer.textContent = `Next ads in ${timeLeft} seconds`;
            
            // Update button
            rewardedBtn.disabled = true;
            rewardedBtn.innerHTML = '<i class="fas fa-clock"></i> Wait for Cooldown';
            
            // Start countdown
            const countdownInterval = setInterval(() => {
                timeLeft--;
                countdownTimer.textContent = `Next ads in ${timeLeft} seconds`;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    appState.adCooldown = false;
                    countdownTimer.style.display = 'none';
                    
                    // Reset button
                    rewardedBtn.disabled = false;
                    rewardedBtn.innerHTML = '<i class="fas fa-play-circle"></i> Watch 2 Ads (+0.001$)';
                }
            }, 1000);
        }

        // Request withdrawal
        function requestWithdrawal() {
            const address = paymentAddress.value.trim();
            const amount = parseFloat(withdrawAmount.value);
            
            // Validation
            if (!address || address.length < 10) {
                showStatus('Please enter a valid TRON address.', 'error');
                return;
            }
            
            if (isNaN(amount) || amount < appState.minWithdrawal) {
                showStatus(`Minimum withdrawal amount is ${appState.minWithdrawal} TRX.`, 'error');
                return;
            }
            
            const balanceInTRX = appState.balance / appState.tronPrice;
            if (amount > balanceInTRX) {
                showStatus('Insufficient balance.', 'error');
                return;
            }
            
            // Create withdrawal request
            const withdrawal = {
                id: generateWithdrawalId(),
                userId: appState.userId,
                address: address,
                amount: amount,
                status: 'pending',
                date: new Date().toISOString()
            };
            
            // Get withdrawals
            let withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
            withdrawals.push(withdrawal);
            localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
            
            // Update balance
            appState.balance -= amount * appState.tronPrice;
            localStorage.setItem('balance', appState.balance);
            
            // Update UI
            updateUI();
            
            // Success message
            showStatus('Your withdrawal request has been received. It will be processed as soon as possible.', 'success');
            
            // Clear form
            paymentAddress.value = '';
            withdrawAmount.value = '';
            updateWithdrawButton();
        }

        // Share referral code
        function shareReferralCode() {
            const message = `Earn TRON with TronAdsFaucet! Use my referral code: ${appState.referralCode}\n\nhttps://t.me/TronAdsFaucetBot`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'TronAdsFaucet',
                    text: message
                }).catch(err => {
                    console.log('Share cancelled:', err);
                    copyToClipboard(message);
                    showStatus('Referral code copied to clipboard!', 'success');
                });
            } else {
                copyToClipboard(message);
                showStatus('Referral code copied to clipboard!', 'success');
            }
        }

        // Apply referral code
        function applyReferralCode() {
            const code = referralInput.value.trim();
            
            if (!code) {
                showStatus('Please enter a referral code.', 'error');
                return;
            }
            
            if (code === appState.referralCode) {
                showStatus('You cannot use your own referral code.', 'error');
                return;
            }
            
            if (appState.hasAppliedReferral) {
                showStatus('You have already applied a referral code.', 'error');
                return;
            }
            
            // Check referral code
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            let referrerId = null;
            
            for (const [userId, userData] of Object.entries(users)) {
                if (userData.referralCode === code) {
                    referrerId = userId;
                    break;
                }
            }
            
            if (!referrerId) {
                showStatus('Invalid referral code.', 'error');
                return;
            }
            
            // Apply referral bonus
            const rewardInTRX = appState.referralReward / appState.tronPrice;
            appState.balance += rewardInTRX;
            localStorage.setItem('balance', appState.balance);
            
            // Save referral
            appState.hasAppliedReferral = true;
            localStorage.setItem('hasAppliedReferral', 'true');
            
            // Update referrer's referral count
            if (users[referrerId]) {
                users[referrerId].referralCount = (users[referrerId].referralCount || 0) + 1;
                users[referrerId].referralEarnings = (users[referrerId].referralEarnings || 0) + rewardInTRX;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Update UI
            updateUI();
            
            // Success message
            showStatus(`Referral bonus: ${rewardInTRX.toFixed(6)} TRX added to your account!`, 'success');
            
            // Clear input
            referralInput.value = '';
        }

        // Update admin panel
        function updateAdminPanel() {
            // Get user data
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
            
            // Calculate statistics
            let totalUsers = Object.keys(users).length;
            let totalAds = 0;
            let totalWithdrawals = 0;
            let totalReferrals = 0;
            let totalWithdrawalAmount = 0;
            
            for (const user of Object.values(users)) {
                totalAds += user.adCount || 0;
                totalReferrals += user.referralCount || 0;
            }
            
            for (const withdrawal of withdrawals) {
                if (withdrawal.status === 'completed') {
                    totalWithdrawals++;
                    totalWithdrawalAmount += withdrawal.amount;
                }
            }
            
            // Show statistics
            adminTotalUsers.textContent = totalUsers;
            adminTotalAds.textContent = totalAds;
            adminTotalWithdrawals.textContent = totalWithdrawals;
            adminTotalReferrals.textContent = totalReferrals;
            
            // Show user list
            adminUserList.innerHTML = '';
            
            if (totalUsers === 0) {
                adminUserList.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">No users found.</p>';
            } else {
                for (const [userId, userData] of Object.entries(users)) {
                    const userElement = document.createElement('div');
                    userElement.className = 'admin-user-item';
                    userElement.innerHTML = `
                        <div class="admin-user-info">
                            <div class="admin-user-id">User#${userId.substring(0, 6)}</div>
                            <div class="admin-user-balance">Balance: ${(userData.balance || 0).toFixed(4)} TRX</div>
                            <div class="admin-user-date">Ads: ${userData.adCount || 0} | Referrals: ${userData.referralCount || 0}</div>
                        </div>
                        <div class="admin-user-actions">
                            <button class="admin-action-btn" onclick="adminAddBalance('${userId}')">+ TRX</button>
                            <button class="admin-action-btn" onclick="adminResetUser('${userId}')">Reset</button>
                        </div>
                    `;
                    adminUserList.appendChild(userElement);
                }
            }
            
            // Show withdrawal requests
            withdrawRequestsList.innerHTML = '';
            
            const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending');
            
            if (pendingWithdrawals.length === 0) {
                withdrawRequestsList.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">No pending withdrawal requests.</p>';
            } else {
                for (const withdrawal of pendingWithdrawals) {
                    const user = users[withdrawal.userId] || {};
                    const requestElement = document.createElement('div');
                    requestElement.className = 'withdraw-request-item';
                    requestElement.innerHTML = `
                        <div class="withdraw-request-info">
                            <div class="withdraw-request-user">User#${withdrawal.userId.substring(0, 6)}</div>
                            <div class="withdraw-request-details">Amount: ${withdrawal.amount.toFixed(4)} TRX</div>
                            <div class="withdraw-request-address" onclick="copyToClipboard('${withdrawal.address}')">${withdrawal.address}</div>
                            <div class="withdraw-request-date">${new Date(withdrawal.date).toLocaleString('en-US')}</div>
                        </div>
                        <div class="withdraw-request-actions">
                            <button class="withdraw-action-btn approve" onclick="adminApproveWithdrawal('${withdrawal.id}')">Approve</button>
                            <button class="withdraw-action-btn reject" onclick="adminRejectWithdrawal('${withdrawal.id}')">Reject</button>
                        </div>
                    `;
                    withdrawRequestsList.appendChild(requestElement);
                }
            }
        }

        // Reset admin statistics
        function resetAdminStats() {
            if (confirm('All statistics will be reset. Are you sure?')) {
                localStorage.removeItem('users');
                localStorage.removeItem('withdrawals');
                updateAdminPanel();
                showStatus('Statistics have been reset.', 'success');
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('ALL data will be deleted. This action cannot be undone. Are you sure?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Update withdraw button
        function updateWithdrawButton() {
            const amount = parseFloat(withdrawAmount.value);
            const address = paymentAddress.value.trim();
            
            if (amount >= appState.minWithdrawal && amount <= (appState.balance / appState.tronPrice) && address.length >= 10) {
                withdrawBtn.disabled = false;
            } else {
                withdrawBtn.disabled = true;
            }
        }

        // Load TRON price from CoinGecko
        async function loadTronPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tron&vs_currencies=usd&include_24hr_change=true');
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.tron) {
                        appState.tronPrice = data.tron.usd;
                        const change24h = data.tron.usd_24h_change || 0;
                        
                        tronPriceElement.textContent = `$${appState.tronPrice.toFixed(4)}`;
                        
                        if (change24h >= 0) {
                            tronChangeElement.textContent = `24h: +${change24h.toFixed(2)}%`;
                            tronChangeElement.className = 'chart-change positive';
                        } else {
                            tronChangeElement.textContent = `24h: ${change24h.toFixed(2)}%`;
                            tronChangeElement.className = 'chart-change negative';
                        }
                        
                        // Update UI with new price
                        updateUI();
                        
                        // Draw chart
                        drawTronChart();
                    }
                } else {
                    throw new Error('Failed to fetch TRON price');
                }
            } catch (error) {
                console.error('Error loading TRON price:', error);
                // Fallback to simulated data
                const simulatedPrice = 0.12 + (Math.random() * 0.02 - 0.01);
                const simulatedChange = (Math.random() * 4 - 2);
                
                appState.tronPrice = simulatedPrice;
                appState.tronChange = simulatedChange;
                
                tronPriceElement.textContent = `$${simulatedPrice.toFixed(4)}`;
                
                if (simulatedChange >= 0) {
                    tronChangeElement.textContent = `24h: +${simulatedChange.toFixed(2)}%`;
                    tronChangeElement.className = 'chart-change positive';
                } else {
                    tronChangeElement.textContent = `24h: ${simulatedChange.toFixed(2)}%`;
                    tronChangeElement.className = 'chart-change negative';
                }
                
                // Update UI with simulated price
                updateUI();
                
                drawTronChart();
            }
        }

        // Draw TRON chart
        function drawTronChart() {
            const ctx = trxChartCanvas.getContext('2d');
            const width = trxChartCanvas.width = trxChartCanvas.offsetWidth;
            const height = trxChartCanvas.height = trxChartCanvas.offsetHeight;
            
            // Clear
            ctx.clearRect(0, 0, width, height);
            
            // Chart data (simulated)
            const dataPoints = 20;
            const data = [];
            let currentPrice = appState.tronPrice;
            
            for (let i = 0; i < dataPoints; i++) {
                currentPrice += (Math.random() * 0.01 - 0.005);
                data.push(currentPrice);
            }
            
            // Draw chart
            const padding = 20;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            const minPrice = Math.min(...data);
            const maxPrice = Math.max(...data);
            const priceRange = maxPrice - minPrice;
            
            // Line
            ctx.beginPath();
            ctx.moveTo(padding, height - padding - ((data[0] - minPrice) / priceRange) * chartHeight);
            
            for (let i = 1; i < data.length; i++) {
                const x = padding + (i / (data.length - 1)) * chartWidth;
                const y = height - padding - ((data[i] - minPrice) / priceRange) * chartHeight;
                ctx.lineTo(x, y);
            }
            
            ctx.strokeStyle = appState.tronChange >= 0 ? '#10b981' : '#d62939';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Fill
            ctx.lineTo(padding + chartWidth, height - padding);
            ctx.lineTo(padding, height - padding);
            ctx.closePath();
            
            const gradient = ctx.createLinearGradient(0, padding, 0, height - padding);
            gradient.addColorStop(0, appState.tronChange >= 0 ? 'rgba(16, 185, 129, 0.2)' : 'rgba(214, 41, 57, 0.2)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            
            ctx.fillStyle = gradient;
            ctx.fill();
        }

        // Initialize Ad Manager
        function initializeAdManager() {
            // Initialize TMA Ad Manager
            if (typeof window.initCdTma === 'function') {
                window.initCdTma({ id: 6093277 })
                    .then(show => {
                        appState.adManager = show;
                        console.log('TMA Ad Manager initialized');
                    })
                    .catch(error => {
                        console.error('Failed to initialize TMA Ad Manager:', error);
                    });
            }
            
            // Check Adexora
            if (typeof window.showAdexora === 'function') {
                appState.adexoraReady = true;
                console.log('Adexora Ad Manager ready');
            }
        }

        // Copy referral code
        function copyReferralCode() {
            copyToClipboard(appState.referralCode);
            showStatus('Referral code copied to clipboard!', 'success');
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).catch(err => {
                    console.error('Clipboard error:', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }

        // Fallback copy
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }

        // Show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 4000);
        }

        // Generate unique user ID
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        // Generate unique referral code
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Generate unique withdrawal ID
        function generateWithdrawalId() {
            return 'wd_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        // Admin functions (global scope)
        window.adminAddBalance = function(userId) {
            const amount = parseFloat(prompt('Amount of TRX to add:'));
            
            if (isNaN(amount) || amount <= 0) {
                showStatus('Invalid amount.', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            if (users[userId]) {
                users[userId].balance = (users[userId].balance || 0) + amount;
                localStorage.setItem('users', JSON.stringify(users));
                updateAdminPanel();
                showStatus(`${amount} TRX added to user.`, 'success');
            }
        };

        window.adminResetUser = function(userId) {
            if (confirm('User data will be reset. Are you sure?')) {
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                
                if (users[userId]) {
                    users[userId].balance = 0;
                    users[userId].adCount = 0;
                    users[userId].dailyAdCount = 0;
                    users[userId].referralCount = 0;
                    users[userId].referralEarnings = 0;
                    localStorage.setItem('users', JSON.stringify(users));
                    updateAdminPanel();
                    showStatus('User data has been reset.', 'success');
                }
            }
        };

        window.adminApproveWithdrawal = function(withdrawalId) {
            const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
            const withdrawalIndex = withdrawals.findIndex(w => w.id === withdrawalId);
            
            if (withdrawalIndex !== -1) {
                withdrawals[withdrawalIndex].status = 'completed';
                localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                updateAdminPanel();
                showStatus('Withdrawal request approved.', 'success');
            }
        };

        window.adminRejectWithdrawal = function(withdrawalId) {
            const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
            const withdrawalIndex = withdrawals.findIndex(w => w.id === withdrawalId);
            
            if (withdrawalIndex !== -1) {
                const withdrawal = withdrawals[withdrawalIndex];
                
                // Return balance
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                if (users[withdrawal.userId]) {
                    users[withdrawal.userId].balance = (users[withdrawal.userId].balance || 0) + withdrawal.amount;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                withdrawals.splice(withdrawalIndex, 1);
                localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                updateAdminPanel();
                showStatus('Withdrawal request rejected and balance returned.', 'success');
            }
        };
    </script>
</body>
</html>
