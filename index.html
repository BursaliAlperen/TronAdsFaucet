<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tron Ads Faucet</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* Google Font Import */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

        /* CSS Variables for Red/White Theming */
        :root {
            --font-family: 'Nunito', sans-serif;
            --bg-color: #ffffff; /* White background */
            --secondary-bg: #f7f7f7; /* Light grey/off-white secondary background */
            --text-color: #1c1c1e; /* Dark text */
            --subtle-text: #6d6d72;
            --primary-color: #ff0000; /* Red primary color */
            --secondary-color: #d60000; /* Darker red for active state/hover */
            --border-color: #e0e0e0;
            --success-color: #28a745;
            --danger-color: #dc3545;
        }

        /* Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* App Container */
        #app { max-width: 500px; margin: 0 auto; padding-bottom: 70px; }

        /* Profile Header */
        .profile-header { padding: 20px 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border-color); }
        .profile-info { display: flex; align-items: center; gap: 15px; }
        #user-photo { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-color); }
        .user-details h1 { font-size: 1.2rem; font-weight: 700; }
        .verified-icon { font-size: 1rem; margin-left: 5px; color: var(--primary-color); }
        .user-details p { font-size: 0.9rem; font-weight: 600; color: var(--subtle-text); }
        #admin-panel-btn { background-color: var(--secondary-color); color: #fff; border: none; padding: 8px 12px; border-radius: 8px; font-weight: 600; font-size: 0.8rem; display: none; }


        /* Main Content & Pages */
        main { padding: 15px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h2 { font-size: 1.5rem; margin-bottom: 15px; }

        /* Menu/Friends/Withdraw Sections */
        .card-section { margin-top: 20px; padding: 20px; border-radius: 12px; background-color: var(--secondary-bg); border: 1px solid var(--border-color); margin-bottom: 15px;}
        .card-section h3 { text-align: center; margin-bottom: 15px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.9rem; margin-bottom: 5px; font-weight: 600; color: var(--text-color); }
        .input-group input, .input-group textarea, .input-group select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--bg-color); font-size: 1rem; }
        .input-group input[readonly] { background-color: #eee; border: 1px dashed var(--primary-color); }
        .btn-full { width: 100%; padding: 12px; border: none; border-radius: 8px; color: #fff; cursor: pointer; font-weight: 600; transition: background-color 0.2s; }
        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: var(--secondary-color); }
        .btn-success { background-color: var(--success-color); margin-top: 10px; }
        .btn-success:hover { background-color: #1e7e34; }

        /* Withdraw Form (Specific) */
        #withdraw-form select { background-color: var(--secondary-bg); }
        #withdraw-form input:focus, #withdraw-form select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.15); }
        
        /* Action Button (Watch Ad / Withdraw) */
        .action-btn { width: 100%; padding: 15px; font-size: 1rem; font-weight: 700; color: #fff; border: none; border-radius: 10px; cursor: pointer; transition: background-color 0.2s, opacity 0.2s; position: relative; display: flex; justify-content: center; align-items: center; background-color: var(--primary-color); }
        .action-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-loader { width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.4); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        .action-btn.loading .btn-text { visibility: hidden; }
        .action-btn.loading .btn-loader { display: block; position: absolute; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Admin Panel Styles */
        .admin-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .admin-stat-card { padding: 15px; border-radius: 10px; text-align: center; background-color: #ffe8e8; border: 1px solid var(--primary-color); }
        .admin-stat-card p { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .admin-stat-card span { font-size: 0.9rem; color: var(--subtle-text); display: block; margin-top: 5px; }

        .withdraw-request-item { padding: 15px; border-radius: 10px; background-color: var(--bg-color); border: 1px solid var(--border-color); margin-bottom: 10px; font-size: 0.9rem; }
        .withdraw-request-item strong { color: var(--primary-color); }
        .withdraw-request-item .action-buttons button { padding: 8px 10px; margin-right: 5px; font-size: 0.8rem; }


        /* Bottom Navigation */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; max-width: 500px; margin: 0 auto; display: flex; justify-content: space-around; padding: 5px 0; border-top: 1px solid var(--border-color); z-index: 1000; background-color: var(--bg-color); }
        .nav-btn { background: none; border: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; padding: 5px 10px; font-family: var(--font-family); font-size: 0.7rem; transition: color 0.2s; flex-grow: 1; color: var(--subtle-text); }
        .nav-btn i { font-size: 1.4rem; margin-bottom: 3px; }
        .nav-btn.active { font-weight: 700; color: var(--primary-color); }
        
        /* Utility */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="app">
        <header class="profile-header">
            <div class="profile-info">
                <img id="user-photo" src="" alt="User Photo">
                <div class="user-details">
                    <h1 id="user-name">Loading... <i class="fas fa-check-circle verified-icon"></i></h1>
                    <p> Balance: $<span id="user-points">0.00</span></p>
                </div>
            </div>
            <button id="admin-panel-btn" class="hidden" data-page="admin-page">Admin Panel</button>
        </header>

        <main id="main-content">
            
            <div id="menu-page" class="page active">
                <h2>Menu</h2>
                
                <div class="card-section">
                    <h3>Current Tron Price (TRX)</h3>
                    <p id="tron-price-display" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color); margin-top: 5px; text-align: center;">$0.00</p>
                </div>

                <div class="card-section">
                    <i class="fas fa-video task-icon" style="font-size: 3rem; margin-bottom: 15px; color: var(--primary-color); display: block; text-align: center;"></i>
                    <h3>Watch a Rewarded Ad</h3>
                    <p style="margin-bottom: 20px; color: var(--subtle-text); text-align: center;">Earn $<span id="ad-reward-display">0.001</span> per ad. Daily Ads Watched: <span id="daily-ads-watched">0</span> / 100</p>
                    <button id="watch-ad-btn" class="action-btn">Watch Ad</button>
                </div>

            </div>

            <div id="friends-page" class="page">
                <h2>Friends & Referrals</h2>
                <div class="card-section">
                    <h3>Your Referral Code</h3>
                    <p style="text-align: center; margin-bottom: 10px;">Share your code and earn a commission.</p>
                    <p style="text-align: center; font-weight: 600; margin-bottom: 15px;">Total Referrals: <span id="referral-count">0</span></p>

                    <div class="input-group">
                        <label for="referral-code">Your Code (Copy & Share)</label>
                        <input type="text" id="referral-code" readonly>
                        <button id="copy-ref-code-btn" class="btn-full btn-primary" style="margin-top: 10px;">Copy Code</button>
                    </div>

                    <div class="input-group" style="margin-top: 20px;">
                        <label for="share-text-area">Pre-filled Share Message</label>
                        <textarea id="share-text-area" readonly style="min-height: 120px;"></textarea>
                        <button id="copy-share-btn" class="btn-full btn-primary" style="margin-top: 10px;">Copy Message</button>
                    </div>
                </div>

                <div class="card-section">
                    <h3>Enter Friend's Code</h3>
                    <p style="text-align: center; color: var(--subtle-text); margin-bottom: 15px;">Enter a referral code to get a sign-up bonus!</p>
                    <form id="enter-referral-form">
                        <div class="input-group">
                            <input type="text" id="friend-code-input" placeholder="Enter Code Here" required>
                        </div>
                        <button type="submit" id="submit-friend-code-btn" class="btn-full btn-success">
                            <span class="btn-text">Apply Code & Get Bonus</span>
                        </button>
                    </form>
                </div>
            </div>
            
            <div id="withdraw-page" class="page">
                <h2>Withdraw</h2>
                <p>Minimum $<span id="min-withdraw-usd">XX</span> or <span id="min-withdraw-trx">0.01</span> TRX required to withdraw.</p>
                <form id="withdraw-form">
                    <div class="form-group">
                        <label for="withdraw-method">Method:</label>
                        <select id="withdraw-method" required>
                            <option value="Tron">Tron (TRX)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="account-number">Tron (TRX) Wallet Address:</label>
                        <input type="text" id="account-number" placeholder="e.g., TYyY8D..." required>
                    </div>
                    <div class="form-group">
                        <label for="amount">Tron (TRX) to Withdraw:</label>
                        <input type="number" id="amount" placeholder="e.g., 0.01" required step="any">
                    </div>
                    <button type="submit" id="withdraw-submit-btn" class="action-btn">
                        <span class="btn-text">Submit Request</span>
                        <span class="btn-loader"></span>
                    </button>
                </form>
            </div>

            <div id="admin-page" class="page">
                <h2>Admin Dashboard</h2>
                
                <div class="admin-stat-grid">
                    <div class="admin-stat-card">
                        <p id="admin-total-balance">0.00</p>
                        <span>Total User Balance ($)</span>
                    </div>
                    <div class="admin-stat-card">
                        <p id="admin-user-count">0</p>
                        <span>Total Users</span>
                    </div>
                </div>
                
                <div class="card-section">
                    <h3>Pending Withdraw Requests</h3>
                    <div id="withdraw-requests-list">
                        <p style="text-align: center; color: var(--subtle-text);">Loading requests from Firebase...</p>
                        </div>
                </div>
            </div>
        </main>

        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="menu-page"><i class="fas fa-bars"></i><span>Menu</span></button>
            <button class="nav-btn" data-page="friends-page"><i class="fas fa-user-friends"></i><span>Friends</span></button>
            <button class="nav-btn" data-page="withdraw-page"><i class="fas fa-wallet"></i><span>Withdraw</span></button>
        </nav>
    </div>

    <div id="loading-modal" class="modal">
        <div class="modal-content"><div class="loader"></div><p>Loading Ad...</p></div>
    </div>
    
    <script src="https://adexora.com/cdn/ads.js?id=494"></script>
    
    <script>
        // --- FIREBASE CONFIGURATION (Provided by User) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCGGHZROaP3RkFs-a293uTFaWn521y3BeM",
            authDomain: "tronadsfaucet.firebaseapp.com",
            databaseURL: "https://tronadsfaucet-default-rtdb.firebaseio.com",
            projectId: "tronadsfaucet",
            storageBucket: "tronadsfaucet.firebasestorage.app",
            messagingSenderId: "26180984735",
            appId: "1:26180984735:web:e498a635c4f61bd0a167aa",
            measurementId: "G-WG3ETVHC78"
        };

        // Initialize Firebase
        if (typeof firebase !== 'undefined' && firebaseConfig.apiKey) {
            firebase.initializeApp(firebaseConfig);
            var db = firebase.firestore();
            console.log("Firebase initialized successfully.");
        } else {
            console.error("Firebase SDK or configuration is missing/invalid.");
            var db = null; 
        }
        // --- END FIREBASE CONFIGURATION ---


        /**
         * GERÇEK TRX FİYATINI ÇEKME FONKSİYONU
         * * NOT: Bu alana, CoinGecko, CoinMarketCap gibi bir servisten 
         * TRX/USD fiyatını çekecek gerçek bir API çağrısı entegre edilmelidir.
         * Aksi takdirde, uygulama $0.1250 sabit değerini kullanmaya devam edecektir.
         */
        async function fetchTronPrice() {
            // Canlı sistemde buraya AJAX/Fetch API çağrısı gelecektir.
            // Örnek: const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tron&vs_currencies=usd');
            // Geçici olarak sabit bir değer döndürülüyor:
            return 0.1250; 
        }

        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;

            // --- Configuration ---
            const BOT_USERNAME = "TronAdsFaucetBot"; 
            const ADMIN_CHAT_ID = "7904032877"; 
            const DAILY_AD_LIMIT = 100; // Updated to 100
            const POINTS_PER_AD = 0.001; 
            const MIN_WITHDRAW_TRX = 0.01; 
            const REFERRAL_BONUS_USD = 0.01; 
            const REFERRER_BONUS_USD = 0.005; 

            let TRON_USD_PRICE = 0.1250; 
            let MIN_WITHDRAW_USD = 0; 
            const IS_ADMIN = tg.initDataUnsafe.user && String(tg.initDataUnsafe.user.id) === ADMIN_CHAT_ID;

            // --- DOM Elements (omitted for brevity) ---
            const dailyAdsWatchedElem = document.getElementById('daily-ads-watched');
            const watchAdBtn = document.getElementById('watch-ad-btn');
            const withdrawForm = document.getElementById('withdraw-form');
            const withdrawSubmitBtn = document.getElementById('withdraw-submit-btn');
            const adminPanelBtn = document.getElementById('admin-panel-btn');

            // Diğer DOM elementleri ve state management kodları burada kalır (kısaltıldı)
            let userState = {
                points: 0, 
                dailyAdWatchCount: 0,
                lastAdWatchDate: null,
                referrals: [],
                referredBy: null,
                userId: null
            };
            
            const saveState = async () => { /* ... */ };
            const loadState = async (userId) => { /* ... */ };
            const updateUI = () => {
                 // ... Diğer UI güncellemeleri
                document.getElementById('user-points').textContent = userState.points.toFixed(4); 
                dailyAdsWatchedElem.textContent = userState.dailyAdWatchCount;
                dailyAdsWatchedElem.nextElementSibling.textContent = ` / ${DAILY_AD_LIMIT}`; 
                document.getElementById('referral-count').textContent = userState.referrals.length;
                document.getElementById('tron-price-display').textContent = `$${TRON_USD_PRICE.toFixed(4)}`;
                document.getElementById('ad-reward-display').textContent = POINTS_PER_AD.toFixed(4);
                document.getElementById('min-withdraw-trx').textContent = MIN_WITHDRAW_TRX.toFixed(2);
                document.getElementById('min-withdraw-usd').textContent = MIN_WITHDRAW_USD.toFixed(4);
                // ...
            };
            const initApp = async () => {
                // ... initialization logic
                TRON_USD_PRICE = await fetchTronPrice();
                MIN_WITHDRAW_USD = MIN_WITHDRAW_TRX * TRON_USD_PRICE;
                updateUI();
                setupNavigation();
                setupEventListeners();
                if (IS_ADMIN) { adminPanelBtn.classList.remove('hidden'); if (db) loadAdminData(); }
                await saveState();
            };
            const setupEventListeners = () => { /* ... */ };
            const copyReferralCode = () => { /* ... */ };
            const copyShareText = () => { /* ... */ };
            const handleSubmitReferralCode = async (e) => { /* ... */ };
            
            const handleWatchAd = () => {
                if (userState.dailyAdWatchCount >= DAILY_AD_LIMIT) { /* ... */ return; }
                
                // Adexora reklam izleme ve puan ekleme mantığı
                window.showAdexora()
                .then(async () => {
                    userState.points = parseFloat((userState.points + POINTS_PER_AD).toFixed(4));
                    userState.dailyAdWatchCount++;
                    await saveState();
                    updateUI();
                    tg.showAlert(`Congratulations! You've earned $${POINTS_PER_AD.toFixed(4)}.`);
                })
                // ... Hata işleme
            };
            
            const handleWithdraw = async (e) => {
                e.preventDefault();
                if (!db) { tg.showAlert("Database connection failed. Cannot process withdrawal."); return; }

                const accountNumber = document.getElementById('account-number').value.trim();
                const amountTrx = parseFloat(document.getElementById('amount').value);

                // ... Kontrol ve doğrulama kodları

                const amountUsd = parseFloat((amountTrx * TRON_USD_PRICE).toFixed(4));
                
                // ... Bakiye kontrolü

                // Bakiye düşüşü ve durumu kaydetme
                userState.points = parseFloat((userState.points - amountUsd).toFixed(4));
                await saveState();
                updateUI();
                
                const user = tg.initDataUnsafe.user;

                try {
                    const request = {
                        userId: user.id,
                        username: user.username,
                        amountTrx: amountTrx,
                        amountUsd: amountUsd,
                        walletAddress: accountNumber,
                        status: "Pending",
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection("withdrawRequests").add(request);

                    /**
                     * ADMİN TELEGRAM BİLDİRİMİ (GERÇEK ENTEGRASYON GEREKLİ)
                     * * NOT: Bot API Token'ı client-side'da tutulmamalıdır.
                     * Bu bildirim, bir Cloud Function (örneğin Firebase Functions) 
                     * veya bir arka uç sunucusu tarafından Firestore'daki yeni 'withdrawRequests' 
                     * kaydını dinleyerek yapılmalıdır.
                     */
                    console.log(`Yeni çekim talebi Firestore'a eklendi. Admin bot bildirimi arka uçta (backend) tetiklenecektir.`); 

                    tg.showAlert("Withdrawal request submitted successfully!");
                    withdrawForm.reset();
                } catch (error) {
                    // ... Hata durumunda geri ödeme ve uyarı
                } finally {
                    // ... Buton durumu güncelleme
                }
            };

            const setupNavigation = () => { /* ... */ };
            const loadAdminData = async () => { /* ... */ };
            const handleAdminAction = async (e) => { /* ... */ };

            initApp();
        });
    </script>
</body>
</html>
